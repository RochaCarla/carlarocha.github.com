<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

  <!-- Basic Page Needs
  ================================================== -->
  <meta charset="utf-8">
  <title>C++ with R on OS X Mavericks</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- RSS
  ================================================== -->
  <link href="http://seananderson.ca/feed.xml" rel="alternate" type="application/rss+xml" title="Sean Anderson" />

  <!-- Mobile Specific Metas
  ================================================== -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- CSS
  ================================================== -->
  <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" rel="stylesheet">
  <link rel="stylesheet" href="/css2.1.6/base.css">
  <link rel="stylesheet" href="/css2.1.6/skeleton.css">
  <link rel="stylesheet" href="/css2.1.6/layout.css">
  <!--<link rel="stylesheet" href="/css2.1.6/tomorrow.css">-->
  <link rel="stylesheet" href="/css2.1.6/syntax2.css">

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Favicons
  ================================================== -->
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

  <!-- Lightbox
  ================================================== -->
  <script src="/js/jquery-1.10.2.min.js"></script>
  <script src="/js/lightbox-2.6.min.js"></script>
  <link href="/css2.1.6/lightbox.css" rel="stylesheet" />

  <!-- Altmetric
  ================================================== -->
  <script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>

  <!-- MathJax
  ================================================== -->
  <script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

</head>

<body>

  <!-- Primary Page Layout
  ================================================== -->

  <div class="container">
    <div class="offset-by-two">
    <div class="twelve columns">
      <div class="masthead">
        <div class="sean">
         <a href="/">Sean C. Anderson</a>
        <br />
      </div>
        <a href="/">About</a>
        <!--<span class="mastdiv">/</span>-->
        <!--<a href="/portfolio.html">Figures</a>-->
        <span class="mastdiv">/</span>
        <a href="/cv.html">CV</a>
        <span class="mastdiv">/</span>
        <a href="/blog.html">Blog</a>
        <span class="mastdiv">/</span>
        <a href="https://github.com/seananderson">Code</a>
        <span class="mastdiv">/</span>
        <a href="/portfolio.html">Figures</a>
        <span class="mastdiv">/</span>
        <a href="http://www.flickr.com/photos/seananderson/">Photos</a>
        <span class="mastdiv">/</span>
        <a href="http://twitter.com/sean_anderson">Twitter</a>
        <span class="mastdiv">/</span>
        <a href="/contact.html">Contact</a>
      </div>


<span class="date">November 18, 2013</span>
  <h1 class="post-title"><a href="/2013/11/18/rcpp-mavericks.html">C++ with R on OS X Mavericks</a></h1>
  <p>Incorporating bits of C++ into your <code class="highlighter-rouge">R</code> coding through the <code class="highlighter-rouge">Rcpp</code> package is a great way to remove bottlenecks in your code and dramatically improve speed — particularly for operations that requires lots of loops with relatively simple data manipulation.</p>

<p>To work with <code class="highlighter-rouge">Rcpp</code> you need a working C++ setup for <code class="highlighter-rouge">R</code>. This is mildly non-trivial on OS X Mavericks, and so instead of explaining this repeatedly, I am writing this as a blog post to refer people to. I gleaned these steps from a combination of <a href="http://www.rstudio.com/ide/docs/packages/prerequisites">RStudio’s documentation</a>, posts by Dirk Eddelbuettel and Romain Francois (developers of <code class="highlighter-rouge">Rcpp</code>) on Stack Overflow, and a resolved issue on the <code class="highlighter-rouge">dplyr</code> GitHub issues tracker that I can no longer find.</p>

<p>First, you need a C++ compiler. For that, you can download XCode and install the Command Line Tools from the preferences. But, XCode.app is a huge application that you don’t need unless you’re developing OS X or iOS applications. Instead you can download just the slimmer Command Line Tools on their own by <a href="https://developer.apple.com/programs/register/">registering as an Apple Developer</a>, and then <a href="https://developer.apple.com/downloads/">downloading</a> the version of the Command Line Tools that is appropriate for your operating system (i.e. Mavericks if that’s why you’re reading this).</p>

<p>Second, you need to tell <code class="highlighter-rouge">R</code> which compilers to use. To do that, we need to create a file <code class="highlighter-rouge">~/.R/Makevars</code>. If you are handy on the command line and have your own favourite text editor, by all means have at it. Otherwise, you can do this with the following commands in Terminal:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="nb">cd</span> ~/.R
nano Makevars
</code></pre>
</div>

<p>Now add the following text:</p>

<div class="language-sh highlighter-rouge"><pre class="highlight"><code><span class="nv">CC</span><span class="o">=</span>clang
<span class="nv">CXX</span><span class="o">=</span>clang++
</code></pre>
</div>

<p>And follow the directions at the bottom of the screen to “write out” and close the file. (Control-O Enter and Control-X.)</p>

<p>OK. Now we need to install <code class="highlighter-rouge">Rcpp</code> from source so it’s built with the same C++ compiler we are using. In <code class="highlighter-rouge">R</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"Rcpp"</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"source"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>A good test that everything is set up correctly is to use the <code class="highlighter-rouge">devtools</code> package. In <code class="highlighter-rouge">R</code>:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">install.packages</span><span class="p">(</span><span class="s2">"devtools"</span><span class="p">)</span><span class="w">
</span><span class="n">devtools</span><span class="o">::</span><span class="n">has_devel</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>If that returns <code class="highlighter-rouge">TRUE</code>, you’re (probably) good to go. If it returns an error, you have a problem. Revisit the above steps and remember that Google is your friend.</p>

<p>As a little test of <code class="highlighter-rouge">Rcpp</code>, try running this trivial example from Hadley Wickham’s awesome <a href="http://adv-r.had.co.nz/Rcpp.html">Advanced R programming</a> book:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">Rcpp</span><span class="p">)</span><span class="w">
</span><span class="n">cppFunction</span><span class="p">(</span><span class="s1">'
  int one() {
    return 1;
  }
'</span><span class="p">)</span><span class="w">
</span><span class="n">one</span><span class="p">()</span><span class="w">
</span></code></pre>
</div>

<p>You should also now be able to install from source <code class="highlighter-rouge">R</code> packages that use C++, such as <a href="https://github.com/hadley/dplyr">dplyr</a>, also known as <code class="highlighter-rouge">plyr</code> 2.0.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><code class="highlighter-rouge">dplyr</code> is a great example of what’s possible with a little C++. I finally got to play with <code class="highlighter-rouge">dplyr</code> last week. <code class="highlighter-rouge">dplyr</code> sliced, diced, and manipulated 16 million rows of data in about 4 seconds. <code class="highlighter-rouge">plyr</code> took approximately… far longer than I was willing to wait around and see. <code class="highlighter-rouge">dplyr</code> makes me excited about the future of data manipulation in <code class="highlighter-rouge">R</code>.</p>



<div class="end-of-post">
</div>

<div class="footer">
        <a href="/colophon.html">Powered by Jekyll and hosted on GitHub</a>
    <span class="mastdiv">/</span>
        <a href="/feed.xml">RSS</a>
    <span class="mastdiv">/</span>
        <a href="http://creativecommons.org/licenses/by-nc/3.0/deed.en_US">CC BY-NC Licensed</a>
</div>

</div>
</div>
</div><!-- container -->

<!-- End Document
================================================== -->
<script type="text/javascript" src="/js/retina.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11566420-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>


