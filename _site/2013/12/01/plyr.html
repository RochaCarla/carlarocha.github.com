<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="ie ie6" lang="en"> <![endif]-->
<!--[if IE 7 ]><html class="ie ie7" lang="en"> <![endif]-->
<!--[if IE 8 ]><html class="ie ie8" lang="en"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--><html lang="en"> <!--<![endif]-->
<head>

  <!-- Basic Page Needs
  ================================================== -->
  <meta charset="utf-8">
  <title>plyr: Split-Apply-Combine for Mortals</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- RSS
  ================================================== -->
  <link href="http://seananderson.ca/feed.xml" rel="alternate" type="application/rss+xml" title="Sean Anderson" />

  <!-- Mobile Specific Metas
  ================================================== -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- CSS
  ================================================== -->
  <link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet'>
  <link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400i,700" rel="stylesheet">
  <link rel="stylesheet" href="/css2.1.6/base.css">
  <link rel="stylesheet" href="/css2.1.6/skeleton.css">
  <link rel="stylesheet" href="/css2.1.6/layout.css">
  <!--<link rel="stylesheet" href="/css2.1.6/tomorrow.css">-->
  <link rel="stylesheet" href="/css2.1.6/syntax2.css">

  <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- Favicons
  ================================================== -->
  <link rel="shortcut icon" href="/images/favicon.ico">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/apple-touch-icon-114x114.png">

  <!-- Lightbox
  ================================================== -->
  <script src="/js/jquery-1.10.2.min.js"></script>
  <script src="/js/lightbox-2.6.min.js"></script>
  <link href="/css2.1.6/lightbox.css" rel="stylesheet" />

  <!-- Altmetric
  ================================================== -->
  <script type='text/javascript' src='https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js'></script>

  <!-- MathJax
  ================================================== -->
  <script type="text/javascript"
src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>

</head>

<body>

  <!-- Primary Page Layout
  ================================================== -->

  <div class="container">
    <div class="offset-by-two">
    <div class="twelve columns">
      <div class="masthead">
        <div class="sean">
         <a href="/">Sean C. Anderson</a>
        <br />
      </div>
        <a href="/">About</a>
        <!--<span class="mastdiv">/</span>-->
        <!--<a href="/portfolio.html">Figures</a>-->
        <span class="mastdiv">/</span>
        <a href="/cv.html">CV</a>
        <span class="mastdiv">/</span>
        <a href="/blog.html">Blog</a>
        <span class="mastdiv">/</span>
        <a href="https://github.com/seananderson">Code</a>
        <span class="mastdiv">/</span>
        <a href="/portfolio.html">Figures</a>
        <span class="mastdiv">/</span>
        <a href="http://www.flickr.com/photos/seananderson/">Photos</a>
        <span class="mastdiv">/</span>
        <a href="http://twitter.com/sean_anderson">Twitter</a>
        <span class="mastdiv">/</span>
        <a href="/contact.html">Contact</a>
      </div>


<span class="date">December  1, 2013</span>
  <h1 class="post-title"><a href="/2013/12/01/plyr.html">plyr: Split-Apply-Combine for Mortals</a></h1>
  <p><em>Along with my <a href="http://seananderson.ca/2013/10/19/reshape.html">earlier post</a> on the <code class="highlighter-rouge">reshape2</code> package, I will continue to post my course notes from Data Wrangling and Visualization in R, a graduate-level course I co-taught last semester at Simon Fraser University.</em></p>

<p><code class="highlighter-rouge">plyr</code> is an <code class="highlighter-rouge">R</code> package that makes it simple to split data apart, do
stuff to it, and mash it back together. This is a common
data-manipulation step. Importantly, <code class="highlighter-rouge">plyr</code> makes it easy to control the
input and output data format with a consistent syntax.</p>

<p>Or, from the documentation:</p>

<p>“<code class="highlighter-rouge">plyr</code> is a set of tools that solves a common set of problems: you need
to break a big problem down into manageable pieces, operate on each
piece and then put all the pieces back together. It’s already possible
to do this with split and the apply functions, but <code class="highlighter-rouge">plyr</code> just makes it
all a bit easier…”</p>

<p>This is a very quick introduction to <code class="highlighter-rouge">plyr</code>. For more details see Hadley
Wickham’s introductory guide <a href="http://www.jstatsoft.org/v40/i01">The split-apply-combine strategy for data
analysis</a>. There’s quite a bit of discussion
online in general, and especially on
<a href="http://stackoverflow.com/questions/tagged/plyr">stackoverflow.com</a>.</p>

<h1 id="why-use-apply-functions-instead-of-for-loops">Why use <code class="highlighter-rouge">apply</code> functions instead of <code class="highlighter-rouge">for</code> loops?</h1>

<ol>
  <li>
    <p>The code is cleaner (once you’re familiar with the concept). The
code can be easier to code and read, and less error prone because you
don’t have to deal with subsetting and you don’t have to deal with saving
your results.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">apply</code> functions can be faster than <code class="highlighter-rouge">for</code> loops, sometimes dramatically.</p>
  </li>
</ol>

<h1 id="plyr-basics"><code class="highlighter-rouge">plyr</code> basics</h1>

<p><code class="highlighter-rouge">plyr</code> builds on the built-in <code class="highlighter-rouge">apply</code> functions by giving you control
over the input and output formats and keeping the syntax consistent
across all variations. It also adds some niceties like error processing,
parallel processing, and progress bars.</p>

<p>The basic format is two letters followed by <code class="highlighter-rouge">ply()</code>. The first letter
refers to the format in and the second to the format out.</p>

<p>The three main letters are:</p>

<ol>
  <li>
    <p><code class="highlighter-rouge">d</code> = data frame</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">a</code> = array (includes matrices)</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">l</code> = list</p>
  </li>
</ol>

<p>So, <code class="highlighter-rouge">ddply</code> means: take a data frame, split it up, do something to it,
and return a data frame. I find I use this the majority of the time
since I often work with data frames. <code class="highlighter-rouge">ldply</code> means: take a list, split
it up, do something to it, and return a data frame. This extends to all
combinations. In the following table, the columns are the input formats
and the rows are the output format:</p>

<table>
  <thead>
    <tr>
      <th>object type</th>
      <th>data frame</th>
      <th>list</th>
      <th>array</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>data frame</td>
      <td><code class="highlighter-rouge">ddply</code></td>
      <td><code class="highlighter-rouge">ldply</code></td>
      <td><code class="highlighter-rouge">adply</code></td>
    </tr>
    <tr>
      <td>list</td>
      <td><code class="highlighter-rouge">dlply</code></td>
      <td><code class="highlighter-rouge">llply</code></td>
      <td><code class="highlighter-rouge">alply</code></td>
    </tr>
    <tr>
      <td>array</td>
      <td><code class="highlighter-rouge">daply</code></td>
      <td><code class="highlighter-rouge">laply</code></td>
      <td><code class="highlighter-rouge">aaply</code></td>
    </tr>
  </tbody>
</table>

<p>I’ve ignored some less common format options:</p>

<ol>
  <li><code class="highlighter-rouge">m</code> = multi-argument function input</li>
  <li><code class="highlighter-rouge">r</code> = replicate a function <code class="highlighter-rouge">n</code> times.</li>
  <li><code class="highlighter-rouge">_</code> = throw away the output</li>
</ol>

<p>For plotting, you might find the underscore (<code class="highlighter-rouge">_</code>) option useful. It will
do something with the data (say add line segments to a plot) and then
throw away the output (e.g., <code class="highlighter-rouge">d_ply()</code>).</p>

<h1 id="base-r-apply-functions-and-plyr">Base R <code class="highlighter-rouge">apply</code> functions and <code class="highlighter-rouge">plyr</code></h1>

<p><code class="highlighter-rouge">plyr</code> provides a consistent and easy-to-work-with format for <code class="highlighter-rouge">apply</code>
functions with control over the input and output formats. Some of the
functionality can be duplicated with base <code class="highlighter-rouge">R</code> functions (but with less
consistent syntax). Also, few <code class="highlighter-rouge">R</code> <code class="highlighter-rouge">apply</code> functions work directly with
data frames as input and output and data frames are a common object
class to work with.</p>

<p>Base <code class="highlighter-rouge">R</code> <code class="highlighter-rouge">apply</code> functions (from a presentation given by Hadley Wickham):</p>

<table>
  <thead>
    <tr>
      <th>object type</th>
      <th>array</th>
      <th>data frame</th>
      <th>list</th>
      <th>nothing</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>array</td>
      <td><code class="highlighter-rouge">apply</code></td>
      <td>.</td>
      <td>.</td>
      <td>.</td>
    </tr>
    <tr>
      <td>data frame</td>
      <td>.</td>
      <td><code class="highlighter-rouge">aggregate</code></td>
      <td><code class="highlighter-rouge">by</code></td>
      <td>.</td>
    </tr>
    <tr>
      <td>list</td>
      <td><code class="highlighter-rouge">sapply</code></td>
      <td>.</td>
      <td><code class="highlighter-rouge">lapply</code></td>
      <td>.</td>
    </tr>
    <tr>
      <td>n replicates</td>
      <td><code class="highlighter-rouge">replicate</code></td>
      <td>.</td>
      <td><code class="highlighter-rouge">replicate</code></td>
      <td>.</td>
    </tr>
    <tr>
      <td>function arguments</td>
      <td><code class="highlighter-rouge">mapply</code></td>
      <td>.</td>
      <td><code class="highlighter-rouge">mapply</code></td>
      <td>.</td>
    </tr>
  </tbody>
</table>

<h1 id="a-general-example-with-plyr">A general example with <code class="highlighter-rouge">plyr</code></h1>

<p>Let’s take a simple example. We’ll take a data frame, split it up by
<code class="highlighter-rouge">year</code>, calculate the coefficient of variation of the <code class="highlighter-rouge">count</code>, and
return a data frame. This could easily be done on one line, but I’m
expanding it here to show the format a more complex function could take.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">set.seed</span><span class="p">(</span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">d</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.frame</span><span class="p">(</span><span class="n">year</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">rep</span><span class="p">(</span><span class="m">2000</span><span class="o">:</span><span class="m">2002</span><span class="p">,</span><span class="w"> </span><span class="n">each</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w">
  </span><span class="n">count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">runif</span><span class="p">(</span><span class="m">9</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">20</span><span class="p">)))</span><span class="w">
</span><span class="n">print</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#   year count
# 1 2000     5
# 2 2000     7
# 3 2000    11
# 4 2001    18
# 5 2001     4
# 6 2001    18
# 7 2002    19
# 8 2002    13
# 9 2002    13
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">plyr</span><span class="p">)</span><span class="w">
</span><span class="n">ddply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">mean.count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">count</span><span class="p">)</span><span class="w">
  </span><span class="n">sd.count</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">x</span><span class="o">$</span><span class="n">count</span><span class="p">)</span><span class="w">
  </span><span class="n">cv</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sd.count</span><span class="o">/</span><span class="n">mean.count</span><span class="w">
  </span><span class="n">data.frame</span><span class="p">(</span><span class="n">cv.count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cv</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#   year cv.count
# 1 2000   0.3985
# 2 2001   0.6062
# 3 2002   0.2309
</code></pre>
</div>

<h1 id="transform-and-summarise"><code class="highlighter-rouge">transform</code> and <code class="highlighter-rouge">summarise</code></h1>

<p>It is often convenient to use these functions within one of the <code class="highlighter-rouge">**ply</code>
functions. <code class="highlighter-rouge">transform</code> acts as it would normally as the base <code class="highlighter-rouge">R</code> function and
modifies an existing data frame. <code class="highlighter-rouge">summarise</code> creates a new condensed data
frame.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="n">summarise</span><span class="p">,</span><span class="w"> </span><span class="n">mean.count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">count</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#   year mean.count
# 1 2000      7.667
# 2 2001     13.333
# 3 2002     15.000
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="n">transform</span><span class="p">,</span><span class="w"> </span><span class="n">total.count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">count</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#   year count total.count
# 1 2000     5          23
# 2 2000     7          23
# 3 2000    11          23
# 4 2001    18          40
# 5 2001     4          40
# 6 2001    18          40
# 7 2002    19          45
# 8 2002    13          45
# 9 2002    13          45
</code></pre>
</div>

<p>Bonus function: <code class="highlighter-rouge">mutate</code>. <code class="highlighter-rouge">mutate</code> works like <code class="highlighter-rouge">transform</code> but lets you
build on columns.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">ddply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="n">mutate</span><span class="p">,</span><span class="w"> </span><span class="n">mu</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">count</span><span class="p">),</span><span class="w"> </span><span class="n">sigma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sd</span><span class="p">(</span><span class="n">count</span><span class="p">),</span><span class="w">
  </span><span class="n">cv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigma</span><span class="o">/</span><span class="n">mu</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#   year count     mu sigma     cv
# 1 2000     5  7.667 3.055 0.3985
# 2 2000     7  7.667 3.055 0.3985
# 3 2000    11  7.667 3.055 0.3985
# 4 2001    18 13.333 8.083 0.6062
# 5 2001     4 13.333 8.083 0.6062
# 6 2001    18 13.333 8.083 0.6062
# 7 2002    19 15.000 3.464 0.2309
# 8 2002    13 15.000 3.464 0.2309
# 9 2002    13 15.000 3.464 0.2309
</code></pre>
</div>

<h1 id="plotting-with-plyr">Plotting with <code class="highlighter-rouge">plyr</code></h1>

<p>You can use <code class="highlighter-rouge">plyr</code> to plot data by throwing away the output with an
underscore (<code class="highlighter-rouge">_</code>). This is a bit cleaner than a for loop since you don’t
have to subset the data manually.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">),</span><span class="w"> </span><span class="n">mar</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="m">1</span><span class="p">),</span><span class="w"> </span><span class="n">oma</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">3</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">d_ply</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="n">transform</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="n">count</span><span class="p">,</span><span class="w"> </span><span class="n">main</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">unique</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"o"</span><span class="p">))</span><span class="w">
</span><span class="n">mtext</span><span class="p">(</span><span class="s2">"count"</span><span class="p">,</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">,</span><span class="w"> </span><span class="n">outer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span><span class="n">mtext</span><span class="p">(</span><span class="s2">"frequency"</span><span class="p">,</span><span class="w"> </span><span class="n">side</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">outer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">line</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p><img src="/knitr-figs/d_ply_plot.png" alt="" /></p>

<h1 id="nested-chunking-of-the-data">Nested chunking of the data</h1>

<p>The basic syntax can be easily extended to break apart the data based on
multiple columns:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">baseball.dat</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">subset</span><span class="p">(</span><span class="n">baseball</span><span class="p">,</span><span class="w"> </span><span class="n">year</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">2000</span><span class="p">)</span><span class="w"> </span><span class="c1"># data from the plyr package
</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ddply</span><span class="p">(</span><span class="n">baseball.dat</span><span class="p">,</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="s2">"team"</span><span class="p">),</span><span class="w"> </span><span class="n">summarize</span><span class="p">,</span><span class="w">
  </span><span class="n">homeruns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">sum</span><span class="p">(</span><span class="n">hr</span><span class="p">))</span><span class="w">
</span><span class="n">head</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#   year team homeruns
# 1 2001  ANA        4
# 2 2001  ARI      155
# 3 2001  ATL       63
# 4 2001  BAL       58
# 5 2001  BOS       77
# 6 2001  CHA       63
</code></pre>
</div>

<h1 id="other-useful-options">Other useful options</h1>

<h2 id="dealing-with-errors">Dealing with errors</h2>

<p>You can use the <code class="highlighter-rouge">failwith</code> function to control how errors are dealt
with.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">1</span><span class="p">)</span><span class="w"> </span><span class="n">stop</span><span class="p">(</span><span class="s2">"Error!"</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="m">1</span><span class="w">
</span><span class="n">safe.f</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">failwith</span><span class="p">(</span><span class="kc">NA</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">quiet</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="c1"># llply(1:2, f)
</span><span class="n">llply</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">safe.f</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code># [[1]]
# [1] NA
#
# [[2]]
# [1] 1
</code></pre>
</div>

<h2 id="parallel-processing">Parallel processing</h2>

<p>In conjunction with a package such as <code class="highlighter-rouge">doParallel</code> you can run your function
separately on each core of your computer. On a dual core machine this make
your code up to twice as fast. Simply register the cores and then set
<code class="highlighter-rouge">.parallel = TRUE</code>. Look at the <code class="highlighter-rouge">elapsed</code> time in these examples:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">x</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="m">10</span><span class="p">)</span><span class="w">
</span><span class="n">wait</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="n">Sys.sleep</span><span class="p">(</span><span class="m">0.1</span><span class="p">)</span><span class="w">
</span><span class="n">system.time</span><span class="p">(</span><span class="n">llply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">wait</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#    user  system elapsed
#   0.001   0.000   1.007
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">system.time</span><span class="p">(</span><span class="n">sapply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">wait</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#    user  system elapsed
#   0.000   0.001   1.009
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">doParallel</span><span class="p">)</span><span class="w">
</span><span class="n">registerDoParallel</span><span class="p">(</span><span class="n">cores</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span><span class="n">system.time</span><span class="p">(</span><span class="n">llply</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">wait</span><span class="p">,</span><span class="w"> </span><span class="n">.parallel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#    user  system elapsed
#   0.024   0.013   0.541
</code></pre>
</div>

<h1 id="so-why-would-i-not-want-to-use-plyr">So, why would I <em>not</em> want to use <code class="highlighter-rouge">plyr</code>?</h1>

<p><code class="highlighter-rouge">plyr</code> can be slow — particularly if you are working with very large
datasets that involve a lot of subsetting. Hadley is working on this and
an in-development version of <code class="highlighter-rouge">plyr</code>, <code class="highlighter-rouge">dplyr</code>, can run much faster (<a href="https://github.com/hadley/dplyr">https://github.com/hadley/dplyr</a>).
However, it’s important to remember that typically the speed that you
can write code and understand it later is the rate-limiting step.</p>

<p>A couple faster options:</p>

<p>Use a base <code class="highlighter-rouge">R</code> <code class="highlighter-rouge">apply</code> function:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">system.time</span><span class="p">(</span><span class="n">ddply</span><span class="p">(</span><span class="n">baseball</span><span class="p">,</span><span class="w"> </span><span class="s2">"id"</span><span class="p">,</span><span class="w"> </span><span class="n">summarize</span><span class="p">,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#    user  system elapsed
#   0.955   0.013   0.975
</code></pre>
</div>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">system.time</span><span class="p">(</span><span class="n">tapply</span><span class="p">(</span><span class="n">baseball</span><span class="o">$</span><span class="n">year</span><span class="p">,</span><span class="w"> </span><span class="n">baseball</span><span class="o">$</span><span class="n">id</span><span class="p">,</span><span class="w">
  </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#    user  system elapsed
#   0.021   0.000   0.022
</code></pre>
</div>

<p>Use the <code class="highlighter-rouge">data.table</code> package:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">data.table</span><span class="p">)</span><span class="w">
</span><span class="n">dt</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">data.table</span><span class="p">(</span><span class="n">baseball</span><span class="p">,</span><span class="w"> </span><span class="n">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"id"</span><span class="p">)</span><span class="w">
</span><span class="n">system.time</span><span class="p">(</span><span class="n">dt</span><span class="p">[,</span><span class="w"> </span><span class="nf">length</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="w"> </span><span class="n">by</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">id</span><span class="p">)])</span><span class="w">
</span></code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>#    user  system elapsed
#   0.010   0.000   0.011
</code></pre>
</div>




<div class="end-of-post">
</div>

<div class="footer">
        <a href="/colophon.html">Powered by Jekyll and hosted on GitHub</a>
    <span class="mastdiv">/</span>
        <a href="/feed.xml">RSS</a>
    <span class="mastdiv">/</span>
        <a href="http://creativecommons.org/licenses/by-nc/3.0/deed.en_US">CC BY-NC Licensed</a>
</div>

</div>
</div>
</div><!-- container -->

<!-- End Document
================================================== -->
<script type="text/javascript" src="/js/retina.js"></script>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-11566420-4']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

</body>
</html>


